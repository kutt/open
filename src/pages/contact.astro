---
import Layout from "../layouts/Layout.astro";
import { Mail, MessageCircle, Send, CheckCircle } from "lucide-astro";
---

<Layout 
  title="Contact Us - Open Alternatives" 
  description="Get in touch with the Open Alternatives team. Send us feedback, suggestions, or report issues."
>
  <div class="bg-white dark:bg-gray-800 transition-colors duration-300">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-4">
          Contact Us
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
          Have a question, suggestion, or found an issue? We'd love to hear from you!
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Contact Info -->
        <div class="space-y-8">
          <div>
            <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">
              Get in Touch
            </h2>
            <p class="text-gray-600 dark:text-gray-300 mb-8">
              We're always looking to improve Open Alternatives. Whether you have feedback, 
              suggestions for new alternatives, or want to report a bug, we're here to help.
            </p>
          </div>

          <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-3">
              What can we help with?
            </h3>
            <ul class="space-y-2 text-gray-600 dark:text-gray-300">
              <li>• Suggesting new open source alternatives</li>
              <li>• Reporting bugs or issues</li>
              <li>• Feedback on the website</li>
              <li>• Partnership opportunities</li>
              <li>• General questions about open source</li>
            </ul>
          </div>
        </div>

        <!-- Contact Form -->
        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-8">
          <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">
            Send us a Message
          </h2>

          <!-- Success Message (hidden by default) -->
          <div id="success-message" class="hidden mb-6 p-4 bg-green-100 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-lg">
            <div class="flex items-center">
              <CheckCircle class="h-5 w-5 text-green-600 dark:text-green-400 mr-2" />
              <p class="text-green-800 dark:text-green-200 font-medium">
                Thank you! Your message has been submitted successfully. We'll get back to you soon.
              </p>
            </div>
          </div>

          <!-- Error Message (hidden by default) -->
          <div id="error-message" class="hidden mb-6 p-4 bg-red-100 dark:bg-red-900 border border-red-200 dark:border-red-700 rounded-lg">
            <p class="text-red-800 dark:text-red-200 font-medium">
              Sorry, there was an error submitting your message. Please try again.
            </p>
          </div>

          <form id="contact-form" class="space-y-6">
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Email Address *
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors"
                placeholder="your@email.com"
              />
            </div>

            <div>
              <label for="subject" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Subject *
              </label>
              <input
                type="text"
                id="subject"
                name="subject"
                required
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors"
                placeholder="What's this about?"
              />
            </div>

            <div>
              <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                Message *
              </label>
              <textarea
                id="message"
                name="message"
                rows="6"
                required
                class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors resize-vertical"
                placeholder="Tell us more about your message..."
              ></textarea>
            </div>

            <div>
              <label class="flex items-start">
                <input
                  type="checkbox"
                  id="newsletter"
                  name="newsletter"
                  class="mt-1 h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600 rounded"
                />
                <span class="ml-2 text-sm text-gray-600 dark:text-gray-300">
                  I'd like to receive updates about new open source alternatives and website improvements.
                </span>
              </label>
            </div>

            <button
              type="submit"
              class="w-full bg-primary-600 hover:bg-primary-700 py-3 px-6 rounded-lg transition-colors flex items-center justify-center"
            >
              <Send class="h-5 w-5 mr-2" />
              Send Message
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Contact Form Script -->
  <script>
    document.getElementById('contact-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const form = e.target;
      const formData = new FormData(form);
      const email = formData.get('email');
      const subject = formData.get('subject');
      const message = formData.get('message');
      const newsletter = formData.get('newsletter') ? 'Yes' : 'No';
      
      const submitButton = form.querySelector('button[type="submit"]');
      const successMessage = document.getElementById('success-message');
      const errorMessage = document.getElementById('error-message');
      
      // Show loading state
      const originalText = submitButton.innerHTML;
      submitButton.innerHTML = '<div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"></div>Sending...';
      submitButton.disabled = true;
      
      // Hide previous messages
      successMessage?.classList.add('hidden');
      errorMessage?.classList.add('hidden');
      
      try {
        // Create GitHub issue
        const issueData = {
          title: `Contact Form: ${subject}`,
          body: `**From:** ${email}\n\n**Message:**\n${message}\n\n**Newsletter Subscription:** ${newsletter}\n\n---\n*This message was submitted via the contact form on openalternatives.github.io*`,
          labels: ['contact-form', 'user-feedback']
        };
        
        // Submit to GitHub API
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(issueData)
        });
        
        if (response.ok) {
          // Show success message
          successMessage?.classList.remove('hidden');
          form.reset();
        } else {
          throw new Error('Failed to submit message');
        }
      } catch (error) {
        console.error('Error submitting contact form:', error);
        errorMessage?.classList.remove('hidden');
      } finally {
        // Reset button state
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
      }
    });
  </script>
</Layout>
